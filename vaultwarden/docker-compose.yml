#docker run -d --name vaultwarden -v /vw-data/:/data/ -p 80:80 vaultwarden/server:latest
version: "3.5"
services:
  app:
    image: vaultwarden/server:1.27.0
    user: 1000:1000
    # admin token generated by openssl rand -base64 48
    environment:
      - ICON_BLACKLIST_NON_GLOBAL_IPS=false
#      - ADMIN_TOKEN=
      - SIGNUPS_ALLOWED=false
    volumes:
      - ./data:/data/
    networks:
      - vaultwarden
    #ports:
    #  - 14000:80
    deploy:
      placement:
        constraints: [ node.role == manager ]

  nginx:
    image: 192.168.0.2:5050/dedyms/nginx:mainline
    networks:
      - vaultwarden
    configs:
      - source: nginx.conf
        target: /etc/nginx/conf.d/default.conf
      - source: nginx.crt
        target: /etc/ssl/localcerts/nginx.crt
      - source: nginx.key
        target: /etc/ssl/localcerts/nginx.key
    ports:
      - 14000:443
    deploy:
      placement:
        constraints: [ node.role == manager ]

configs:
  nginx.conf:
    file: nginx.conf
  nginx.crt:
    file: ssl/vaultwarden.crt
  nginx.key:
    file: ssl/vaultwarden.key

networks:
  vaultwarden:
    name: vaultwarden