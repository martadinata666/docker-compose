version: '3'
services:
  app:
    image: vaultwarden/server:1.28.0
    user: 1000:1000
    # admin token generated by openssl rand -base64 48
    environment:
      - ICON_BLACKLIST_NON_GLOBAL_IPS=false
      - ADMIN_TOKEN=sometokenjustfortest
      - SIGNUPS_ALLOWED=false
    volumes:
      - ./data:/data/
    ports:
      - 15000:80

  ldap_sync:
    image: martadinata666/vaultwarden-ldap:1.0.0-1
    volumes:
      - ./config.toml:/config.toml:ro
    environment:
      CONFIG_PATH: /config.toml
      RUST_BACKTRACE: 1
    depends_on:
      - app
    restart: always
